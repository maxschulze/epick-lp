angular.module("epickApp").controller("CreateProfileController",["$scope","$document","$http","$window","$cookies",function(e,o,i,r){e.submit_label="Continue",e.step=1,e.profile=JSON.parse(sessionStorage.getItem("current_user")),void 0!=e.profile&&(r.location.href="/edit-profile/"),e.profile={looking_for_ranked_team:!1,looking_to_build_ranked_team:!1,looking_for_compatible_team:!1,use_voice_chat:!1,favorite_role:"defense",selected_heros:[]},e.heroFilter={role:"defense"},e.regions=window.epick.regions,e.region={},e.$watch("region.selected",function(o){o&&(e.profile.region=o.id)}),e.locations=window.epick.locations,e.location={},e.$watch("location.selected",function(o){o&&(e.profile.location=o.id)}),e.languages=window.epick.languages,e.language={},e.$watch("language.selected",function(o){o&&(e.profile.language=o.id)}),e.genders=window.epick.genders,e.gender={},e.$watch("gender.selected",function(o){o&&(e.profile.gender=o.id)}),e.ages=window.epick.ages,e.age={},e.$watch("age.selected",function(o){o&&(e.profile.age=o.id)}),e.game_times=window.epick.game_times,e.game_time={},e.$watch("game_time.selected",function(o){o&&(e.profile.game_time_per_week=o.id)}),e.$watch("profile.favorite_role",function(o){e.heroFilter.role=o}),e.$watch("profile.avatar_id",function(o){o&&""!=o&&(e.avatarStyle={"background-image":"url('/images/heroes/"+o+"@2x.png')"})}),e.$watchCollection("profile.selected_heros",function(o){o&&(e.profile.favorite_hero_ids=o.join(","))}),e.next=function(){e.form.$valid&&(e.step=2)},e.save=function(){return!e.saving&&(!e.form.$invalid&&!e.account_form.$invalid&&(e.saving=!0,void i.post(window.epick.api_endpoint+"/profiles",e.profile).then(function(o){o.data.errors?(o.data.errors.email_exists&&(e.email_exists=!0),o.data.errors.battle_tag_exists&&(e.step=1),e.battle_tag_exists=!0):(e.profile.token=o.data.token,o.data.permalink?(delete e.profile.password,delete e.profile.password_confirmation,sessionStorage.setItem("current_user",JSON.stringify(e.profile)),r.location.href="/profiles/"+o.data.permalink):(alert("Something went wrong during profile creation. Please contact us."),Rollbar.error("Create Profile failed because of lacking permalink",{profile:e.profile,response:o}))),e.saving=!1},function(o){e.fail(),Rollbar.error("Create Profile failed",{profile:e.profile,response:o}),e.saving=!1})))},e.fail=function(){alert("Sorry, there was an error creating your account. Please make sure your Gamer Tag and E-Mail have not been used yet. If you think this is an error, contact us at hi@epick.gg!")}}]).config(function(){});