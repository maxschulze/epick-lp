angular.module("epickApp").controller("EditProfileController",["$scope","$document","$http","$window","$cookies","$timeout",function(e,i,o,r,n,t){e.submit_label="Save",e.profile=JSON.parse(sessionStorage.getItem("current_user")),null==e.profile&&(r.location.href="/login"),e.profile.selected_heros=e.profile.favorite_hero_ids,void 0==e.profile.selected_heros&&(e.profile.selected_heros=[]),e.heroFilter={role:e.profile.favorite_role},e.regions=window.epick.regions,e.region={},e.region.selected=_.find(e.regions,{id:e.profile.region}),e.$watch("region.selected",function(i){i&&(e.profile.region=i.id)}),e.locations=window.epick.locations,e.location={},e.location.selected=_.find(e.locations,{id:e.profile.location}),e.$watch("location.selected",function(i){i&&(e.profile.location=i.id)}),e.languages=window.epick.languages,e.language={},e.language.selected=_.find(e.languages,{id:e.profile.language}),e.$watch("language.selected",function(i){i&&(e.profile.language=i.id)}),e.genders=window.epick.genders,e.gender={},e.gender.selected=_.find(e.genders,{id:e.profile.gender}),e.$watch("gender.selected",function(i){i&&(e.profile.gender=i.id)}),e.ages=window.epick.ages,e.age={},e.age.selected=_.find(e.ages,{id:e.profile.age}),e.$watch("age.selected",function(i){i&&(e.profile.age=i.id)}),e.game_times=window.epick.game_times,e.game_time={},e.game_time.selected=_.find(e.game_times,{id:e.profile.game_time_per_week}),e.$watch("game_time.selected",function(i){i&&(e.profile.game_time_per_week=i.id)}),e.$watch("profile.avatar_id",function(i){i&&(e.avatarStyle={"background-image":"url('/images/heroes/"+i+"@2x.png')"})}),e.$watch("profile.favorite_role",function(i){e.heroFilter.role=i}),e.$watchCollection("profile.selected_heros",function(i){i&&i.length>0&&(e.profile.favorite_hero_ids=i.join(","))}),e.save=function(){return!e.saving&&(!e.form.$invalid&&(e.saving=!0,void o.put(window.epick.api_endpoint+"/profiles/"+e.profile.token,e.profile).then(function(i){i.error?(Rollbar.error("Profile save failed with error",{user:e.profile,response:i}),e.fail()):(e.profile.token=i.data.token,alert("Your profile was saved!"),sessionStorage.setItem("current_user",JSON.stringify(e.profile)),t(function(){r.location.href="/profiles/"+e.profile.permalink},1e3)),e.saving=!1},function(i){Rollbar.error("Profile save failed",{user:e.profile,response:i}),e.fail(),e.saving=!1})))},e.next=e.save,e.fail=function(){alert("Sorry, there was an error saving your account. If you think this is an error, contact us at hi@epick.gg!")}}]).config(function(){});